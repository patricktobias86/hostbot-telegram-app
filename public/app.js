const showMessage=(e,t)=>{const s=document.getElementById(e);s&&(s.textContent=t)},tg=window.Telegram.WebApp.initDataUnsafe,{username:username}=tg.user,userName=username?username.toLowerCase():"";async function callNetlifyFunction(e,t={}){try{const s=await fetch(`/.netlify/functions/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error(`Server responded with status: ${s.status}`);return await s.json()}catch(e){return console.error("API Error:",e),showMessage("errorMsg","Failed to process request."),null}}async function selfAssignDiscordId(e){return await callNetlifyFunction("selfAssign",{userName:e})}const disableButton=(e,t=15e3)=>{e.disabled=!0;const s=e.textContent;e.textContent="Please wait...",setTimeout((()=>{e.disabled=!1,e.textContent=s}),t)};document.getElementById("apiRequestBtn")?.addEventListener("click",(async()=>{const e=document.getElementById("apiRequestBtn");userName?Telegram.WebApp.showConfirm("You need to help out with promo when you co-host every now and then. If you don't want to promo, there is no need to co-host.",(async t=>{if(!t)return;disableButton(e);const s=await selfAssignDiscordId(userName);s?.message?showMessage("responseMsg",s.message):showMessage("errorMsg","Failed to self-assign Discord ID.")})):showMessage("errorMsg","Telegram username not found")}));